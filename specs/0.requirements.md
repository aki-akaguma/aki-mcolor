# aki-mcolor: Software Requirements Specification

This document outlines the functional, command-line interface, and non-functional requirements for the `aki-mcolor` command-line utility.

## 1. Functional Requirements

1.  **Input/Output:** The application shall read text from standard input (stdin) and write the processed text to standard output (stdout).
2.  **Core Functionality:** The primary function is to highlight text by applying specific colors to substrings that match provided regular expressions.
3.  **Coloring:** The application must support highlighting with the following colors:
    - Red
    - Green
    - Blue
    - Cyan
    - Magenta
    - Yellow
4.  **Unmarking:** The application shall support an "unmark" option. Substrings matching the "unmark" regular expression will not be colored, which can override other color matches.
5.  **Multiple Patterns:** The system must support receiving multiple regular expression patterns, each associated with a specific color, in a single execution.
6.  **Match Precedence:** If multiple regular expressions match the same text segment, the pattern that is processed last will determine the final color of that segment. The order of processing is determined by the implementation's iteration over the provided color options.
7.  **No Match Passthrough:** Lines from the input that do not contain any matches for the provided regular expressions shall be passed through to the output unmodified.
8.  **Output Formatting:** The output text will use ANSI escape codes to render the colors in a compatible terminal environment.

## 2. Command-Line Interface (CLI) Requirements

1.  **Argument-Driven:** The application's behavior shall be controlled via command-line options.
2.  **Color Options:** The following options must be implemented, each accepting a regular expression `<exp>` as its value:
    - `-r <exp>`, `--red <exp>`: Colors the matching text red.
    - `-g <exp>`, `--green <exp>`: Colors the matching text green.
    - `-b <exp>`, `--blue <exp>`: Colors the matching text blue.
    - `-c <exp>`, `--cyan <exp>`: Colors the matching text cyan.
    - `-m <exp>`, `--magenda <exp>`: Colors the matching text magenta.
    - `-y <exp>`, `--yellow <exp>`: Colors the matching text yellow.
    - `-u <exp>`, `--unmark <exp>`: Removes any color from the matching text.
3.  **Multiple Options:** Users can specify any number of the color options in a single command invocation.
4.  **Help and Version:**
    - `-H`, `--help`: Must display a usage and help message and then exit with a status code of 0.
    - `-V`, `--version`: Must display the application's version information and then exit with a status code of 0.
5.  **Error Handling:**
    - If the command is invoked without at least one color/unmark option (`-r`, `-g`, `-b`, `-c`, `-m`, `-y`, `-u`), it must print an error message to standard error (stderr) and exit with a non-zero status code.
    - If an invalid option is provided, it must print an error message to stderr and exit with a non-zero status code.

## 3. Non-Functional Requirements

1.  **Customization:** The specific ANSI escape code sequences used for coloring must be customizable through the following environment variables:
    - `AKI_MCOLOR_COLOR_SEQ_RED_ST`
    - `AKI_MCOLOR_COLOR_SEQ_GREEN_ST`
    - `AKI_MCOLOR_COLOR_SEQ_BLUE_ST`
    - `AKI_MCOLOR_COLOR_SEQ_CYAN_ST`
    - `AKI_MCOLOR_COLOR_SEQ_MAGENDA_ST`
    - `AKI_MCOLOR_COLOR_SEQ_YELLOW_ST`
    - `AKI_MCOLOR_COLOR_SEQ_ED` (The sequence to end coloring)
2.  **Stream Processing:** The application must process input line-by-line to handle large data streams efficiently without requiring to load the entire input into memory.
3.  **Error Resilience:** The application should handle `BrokenPipe` I/O errors gracefully (e.g., when its output is piped to a command like `head` that closes the stream early), exiting without a failure message.
